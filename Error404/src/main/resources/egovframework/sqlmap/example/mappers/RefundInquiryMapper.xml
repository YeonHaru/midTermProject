<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="egovframework.example.refundInquiry.service.impl.RefundInquiryMapper">

  <!-- 1:1 문의 등록 -->
  <insert id="insertRefundInquiry" parameterType="RefundInquiryVO">
    INSERT INTO REFUND_INQUIRY (
      ID,
      USER_ID,
      TITLE,
      CONTENT,
      REQUEST_DATE
    ) VALUES (
      REFUND_INQUIRY_SEQ.NEXTVAL,
      #{userId},
      #{title},
      #{content},
      SYSDATE
    )
  </insert>

  <!-- 사용자 ID로 문의 목록 조회 ( ANSWER, ANSWER_DATE 추가됨) -->
  <select id="selectInquiriesByUserId" parameterType="String"
          resultType="RefundInquiryVO">
    SELECT
      ID,
      USER_ID,
      TITLE,
      CONTENT,
      REQUEST_DATE,
      ANSWER,
      ANSWER_DATE
    FROM
      REFUND_INQUIRY
    WHERE
      USER_ID = #{userId}
    ORDER BY
      REQUEST_DATE DESC
  </select>

  <!-- 관리자 답변 등록 -->
  <update id="updateInquiryAnswer" parameterType="RefundInquiryVO">
    UPDATE REFUND_INQUIRY
    SET
      ANSWER = #{answer},
      ANSWER_DATE = SYSDATE
    WHERE
      ID = #{id}
  </update>

  <!-- ID로 단건 조회 (관리자 폼에서 사용) -->
  <select id="selectInquiryById" parameterType="long" resultType="RefundInquiryVO">
    SELECT 
      ID,
      USER_ID,
      TITLE,
      CONTENT,
      REQUEST_DATE,
      ANSWER,
      ANSWER_DATE
    FROM REFUND_INQUIRY
    WHERE ID = #{id}
  </select>

</mapper>
