<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="egovframework.example.users.service.impl.UsersMapper">

    <select id="selectUsersList" parameterType="Criteria" resultType="UsersVO">
        SELECT * FROM USERS
        WHERE NAME LIKE '%' || #{searchKeyword} || '%'
        OFFSET #{firstIndex} ROWS
        FETCH NEXT #{pageUnit} ROWS ONLY
    </select>

    <select id="selectUserById" resultType="UsersVO" parameterType="String">
        SELECT 
            USERID,
            PASSWORD,
            NAME,
            EMAIL,
            PHONE,
            JOIN_DATE,
            ROLE,
            GENDER,
            BIRTHDATE,
            ADDRESS,
            POINT,
            PROMO_AGREE AS promoAgree,
            POST_NOTIFY_AGREE AS postNotifyAgree,
            GRADE,
            TEMP_PW_YN AS tempPwYn,
            TOTAL_PURCHASE  
        FROM USERS
        WHERE USERID = #{userid}
    </select>

    <select id="findUserId" resultType="String">
        SELECT userid
        FROM USERS
        WHERE name = #{name} AND email = #{email}
    </select>

    <select id="findPassword" resultType="String">
        SELECT password
        FROM USERS
        WHERE userid = #{userid} AND email = #{email}
    </select>
    
     <update id="updatePassword">
	UPDATE USERS
	SET PASSWORD = #{password},
	TEMP_PW_YN = 'Y'
	WHERE USERID = #{userid}
    </update>
    
    <insert id="insertUser" parameterType="UsersVO">
    INSERT INTO USERS (
        USERID, PASSWORD, NAME, EMAIL, PHONE, JOIN_DATE, ROLE,
        GENDER, BIRTHDATE, ADDRESS, POINT, PROMO_AGREE, POST_NOTIFY_AGREE, GRADE
    )
    VALUES (
        #{userid}, #{password}, #{name}, #{email}, #{phone}, #{join_date}, #{role},
        #{gender}, #{birthdate}, #{address}, #{point}, #{promoAgree}, #{postNotifyAgree}, #{grade}
    )
</insert>

<update id="updatePasswordPermanent">
    UPDATE USERS
    SET PASSWORD = #{password},
        TEMP_PW_YN = 'N'
    WHERE USERID = #{userid}
</update>

<!-- 로그인 회원 대상 최근 본 상품 조회 리모콘으로 구현 -->
<!-- 최근 본 상품 조회 -->
<select id="getRecentBooks" parameterType="String" resultType="String">
  SELECT recent_books
  FROM users
  WHERE userid = #{userid}
</select>

<!-- 최근 본 상품 업데이트 -->
<update id="updateRecentBooks" parameterType="map">
  UPDATE users
  SET recent_books = #{recent_books}
  WHERE userid = #{userid}
</update>




</mapper>
