<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="egovframework.example.book.service.impl.BookMapper">
<select id="searchBookList"
		parameterType="Criteria"
		resultType="BookVO">
	SELECT * 
    FROM BOOKS
    
    <!-- 덕규 : 헤더에 있는 검색창영역 키워드가 있으면 검색조건 추가 하는 where sql문입니다.  -->
		 <where>
		      <if test="searchKeyword != null and searchKeyword.trim() != ''">
		        <choose>
		        
		          	<when test="searchCondition == 'title'">
					  AND title LIKE '%' || #{searchKeyword} || '%'
					</when>
					
					<when test="searchCondition == 'author'">
					  AND author LIKE '%' || #{searchKeyword} || '%'
					</when>
					
					<otherwise>
					  AND (title LIKE '%' || #{searchKeyword} || '%'
					       OR author LIKE '%' || #{searchKeyword} || '%')
					</otherwise>					
		        </choose>		        
		      </if>	      
		    </where>
 <!-- 요기까지에용 -->
		</select>


	<select id="selectBookList" resultType="BookVO"
		parameterType="Criteria">
		SELECT * FROM BOOKS
		WHERE 1=1
		<if test="nat != null"> AND UPPER(NAT) = UPPER(#{nat}) </if>
		<if test="category != null"> AND UPPER(CATEGORY) = UPPER(#{category}) </if>
	</select>

	<select id="selectBook" parameterType="int" resultType="BookVO">
		SELECT *
		FROM BOOKS
		WHERE BNO = #{bno}
	</select>
	
	<!-- 메인페이지 신간 도서 4개용(승화) -->
	<select id="selectLatestBooks" resultType="BookVO">
    SELECT *
    FROM BOOKS
    ORDER BY PDATE DESC
    FETCH FIRST 4 ROWS ONLY
   </select>
   
   <!-- 메인페이지 랜덤 도서 4개용(승화) -->
<select id="selectRandomBooks" resultType="BookVO">
  SELECT *
  FROM (
    SELECT * FROM BOOKS
    ORDER BY DBMS_RANDOM.VALUE
  )
  WHERE ROWNUM &lt;= 4
</select>

		<!-- id="메소드명", parameterType="매개변수자료형", resultType="리턴자료형" -->
		<select 	id="selectBookListTotCnt"
						parameterType="Criteria"
						resultType="int"
		 >
				SELECT COUNT(*) FROM TB_BOOK
				WHERE BNO LIKE '%' || #{searchKeyword} ||'%'
		</select>

	</mapper>	

